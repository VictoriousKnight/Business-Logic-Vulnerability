$(document).ready(function () {
    $('.add-to-cart-btn').on('click', function () {
        var productId = $(this).data('product-id');

        $.ajax({
            url: '/add_to_cart',
            method: 'POST',
            data: {
                productId: productId
            },
            success: function (response) {
                Swal.fire({
                    icon: 'success',
                    title: 'Success!',
                    text: response.message,
                    showConfirmButton: false,
                    timer: 1500
                });
            },
            error: function (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: error.responseJSON.error,
                });
            }
        });
    });

    $('.remove-from-cart-btn').on('click', function () {
        var productId = $(this).data('product-id');

        $.ajax({
            url: '/remove_from_cart',
            method: 'POST',
            data: {
                productId: productId
            },
            success: function (response) {
                Swal.fire({
                    icon: 'success',
                    title: 'Success!',
                    text: response.message,
                    showConfirmButton: false,
                    timer: 1500
                }).then(function () {
                    location.reload(); // Reload the page after successful removal
                });
            },
            error: function (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: error.responseJSON.error,
                });
            }
        });
    });


    $('#login-form').on('submit', function (e) {
        e.preventDefault();
        var username = $('#username').val();
        var password = $('#password').val();

        $.ajax({
            type: 'POST',
            url: '/login',
            data: { username: username, password: password },
            success: function (response) {
                Swal.fire({
                    title: 'Success!',
                    text: 'Logged in successfully!',
                    icon: 'success',
                    confirmButtonText: 'OK'
                }).then(() => {
                    window.location.href = '/';
                });
            },
            error: function (xhr, status, error) {
                Swal.fire({
                    title: 'Error!',
                    text: 'Incorrect credentials!',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
            }
        });
    });

    $('#logout-btn').on('click', function () {
        $.ajax({
            type: 'POST',
            url: '/logout',
            success: function (response) {
                Swal.fire({
                    title: 'Success!',
                    text: 'Logged out successfully!',
                    icon: 'success',
                    confirmButtonText: 'OK'
                }).then(() => {
                    window.location.href = '/';
                });
            },
            error: function (xhr, status, error) {
                Swal.fire({
                    title: 'Error!',
                    text: 'Error logging out: ' + error,
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
            }
        });
    });
});
